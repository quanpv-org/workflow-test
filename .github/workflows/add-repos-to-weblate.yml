name: Add Repositories to Weblate

on:
  workflow_dispatch:
    inputs:
      connector_name:
        description: 'Connector name (leave empty for all repos)'
        required: false
        default: ''
        type: string
      weblate_url:
        description: 'Weblate URL'
        required: true
        default: 'https://hosted.weblate.org'
        type: string
      weblate_project:
        description: 'Weblate Project Slug'
        required: true
        default: 'axonivy-marketplace'
        type: string
      weblate_token:
        description: 'Weblate API Token'
        required: true
        type: string

jobs:
  add-to-weblate:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y jq curl

      - name: Authenticate GitHub CLI
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "$GITHUB_TOKEN" | gh auth login --with-token

      - name: Add repositories to Weblate
        env:
          CONNECTOR_NAME: ${{ inputs.connector_name }}
          WEBLATE_URL: ${{ inputs.weblate_url }}
          WEBLATE_PROJECT: ${{ inputs.weblate_project }}
          WEBLATE_TOKEN: ${{ inputs.weblate_token }}
        run: |
          chmod +x add-repos-to-weblate.sh

          ./add-repos-to-weblate.sh



